<!DOCTYPE html>
<html>
<head>
  <title>Create Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    h4.section-title {
        color: #f26522;
        border-bottom: 2px solid #f26522;
        padding-bottom: 5px;
        margin-top: 30px;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-4 border rounded mt-4 mb-4" style="border-color: #f26522 !important; background-color: #ffffff;">
  <h4 class="section-title p-3">Event Details</h4>

  <form method="POST" enctype="multipart/form-data" class="bg-white p-3">
    {% csrf_token %}

    {% if messages %}
      {% for message in messages %}
        <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %}">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <div class="row mb-3">
  <div class="col-md-6">{{ form.username.label_tag }}<span style="color: red;">*</span>{{ form.username }}</div>
  <div class="col-md-6">{{ form.user_type.label_tag }}<span style="color: red;">*</span>{{ form.user_type }}</div>
</div>

<div class="row mb-3" id="ministry" style="display: none;">
  <div class="col-md-6">{{ form.ministry_name.label_tag }}<span style="color: red;">*</span>{{ form.ministry_name }}</div>
  <div class="col-md-6">{{ form.department.label_tag }}<span style="color: red;">*</span>{{ form.department }}</div>
</div>

<div class="row mb-3" id="state" style="display: none;">
  <div class="col-md-6">{{ form.state.label_tag }}<span style="color: red;">*</span>{{ form.state }}</div>
  <div class="col-md-6">{{ form.district.label_tag }}<span style="color: red;">*</span>{{ form.district }}</div>
</div>

<div class="row mb-3">
  <div class="col-md-6">{{ form.event_name.label_tag }}<span style="color: red;">*</span>{{ form.event_name }}</div>
  <div class="col-md-6">{{ form.event_state.label_tag }}<span style="color: red;">*</span>{{ form.event_state }}</div>
</div>

<div class="row mb-3">
  <div class="col-md-6">{{ form.event_district.label_tag }}<span style="color: red;">*</span>{{ form.event_district }}</div>
  <div class="col-md-6">{{ form.event_venue.label_tag }}<span style="color: red;">*</span>{{ form.event_venue }}</div>
</div>

<div class="row mb-3">
  <div class="col-md-4">{{ form.event_start_date.label_tag }}<span style="color: red;">*</span>{{ form.event_start_date }}</div>
  <div class="col-md-4">{{ form.event_end_date.label_tag }}<span style="color: red;">*</span>{{ form.event_end_date }}</div>
  <div class="col-md-4">{{ form.event_time.label_tag }}<span style="color: red;">*</span>{{ form.event_time }}</div>
</div>

<div class="row mb-3">
  <div class="col-md-6">{{ form.no_of_participants.label_tag }}<span style="color: red;">*</span>{{ form.no_of_participants }}</div>
  <div class="col-md-6">{{ form.event_description.label_tag }}<span style="color: red;">*</span>{{ form.event_description }}</div>
</div>

<h4 class="section-title">Upload Media & Documents</h4>
<div class="row mb-3">
  <div class="col-md-6">
    <label>Event Pictures (Up to 5 images)<span style="color: red;">*</span></label>
    {{ image_form.image }}
  </div>
  <div class="col-md-6">
    <label>Event Videos (Up to 5 videos)<span style="color: red;">*</span></label>
    {{ video_form.video }}
  </div>
</div>

<div class="row mb-3">
  <div class="col-12">{{ form.youtube_links.label_tag }}<span style="color: red;">*</span>{{ form.youtube_links }}</div>
</div>

<div class="form-check mb-3">
  <input type="checkbox" class="form-check-input" id="terms" name="terms" value="accepted" required>
  <label class="form-check-label" for="terms" aria-required="true">
    By continuing, you agree to <a href="#">Terms and Conditions</a> and <a href="#">Privacy Policy</a> of Vande Mataram <span style="color: red;">*</span>
  </label>
</div>

<div class="d-flex justify-content-end">
  <button type="reset" class="btn btn-outline-secondary me-2">Cancel</button>
  <button type="submit" class="btn btn-warning text-white">Upload Event</button>
</div>

<script>  
document.getElementById("id_user_type").addEventListener("change", function() {
  let type = this.value;
  let ministry = document.getElementById("ministry");
  let state = document.getElementById("state");
  if (type === "Ministry") {
    // Ministry dropdown
    let ministrySelect = document.getElementById("id_ministry_name");
    ministry.style.display = "flex";
    state.style.display = "none";
    ministrySelect.innerHTML = ""; // clear old options

    // Load ministries via AJAX (example JSON)
    fetch("/api/ministries")  // Django view returns manager.json data
      .then(res => res.json())
      .then(data => {
        data.forEach(m => {
          let opt = document.createElement("option");
          opt.value = m.id;
          opt.textContent = m.ministry_name;
          ministrySelect.appendChild(opt);
        });
      });

    // Department text input
    let deptInput = document.getElementById("id_department");
    deptInput.value = ""; // clear old value
    deptInput.placeholder = "Enter Department";

  } else if (type === "State") {
    // State dropdown
    let stateSelect = document.getElementById("id_state");
    stateSelect.innerHTML = ""; // clear old options
    ministry.style.display = "none";
    state.style.display = "flex";
    console.log(state);
    fetch("/api/states")  // Django view returns state.json data
      .then(res => res.json())
      .then(data => {
        data.stateList.forEach(s => {
          let opt = document.createElement("option");
          opt.value = s.id;
          opt.textContent = s.name;
          stateSelect.appendChild(opt);
        });
      });

    // District dropdown (loads after state selection)
    let districtSelect = document.getElementById("id_district");
    districtSelect.innerHTML = ""; // clear old options

    stateSelect.addEventListener("change", function() {
      let stateId = this.value;
      districtSelect.innerHTML = "";

      fetch(`/api/districts?state_id=${stateId}`) // Django view returns districtList
        .then(res => res.json())
        .then(data => {
          data.districtList.forEach(d => {
            let opt = document.createElement("option");
            opt.value = d.id;
            opt.textContent = d.name;
            districtSelect.appendChild(opt);
          });
        });
    });
  }
});
</script>
