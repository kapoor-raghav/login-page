<!DOCTYPE html>
<html>
<head>
  <title>Create Event</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    h4.section-title {
        color: #f26522;
        border-bottom: 2px solid #f26522;
        padding-bottom: 5px;
        margin-top: 30px;
    }
    .error-message {
        color: #dc3545; /* Bootstrap danger color */
        font-size: 0.875rem;
        margin-top: 4px;
    }
  </style>
</head>
<body class="bg-light w-50 mx-auto">
<div class="container py-4 border rounded mt-4 mb-4" style="border-color: #f26522 !important; background-color: #ffffff;">
  <h4 class="section-title p-3">Event Details</h4>

  <form method="POST" enctype="multipart/form-data" class="bg-white p-3 ">
    {% csrf_token %}

    <!-- Global messages -->
    {% if messages %}
  {% for message in messages %}
    <div class="alert {% if message.tags == 'error' %}alert-danger{% else %}alert-{{ message.tags }}{% endif %} alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}


    <div class="row mb-3">
      <div class="col-md-6">
        {{ form.username.label_tag }}<span style="color: red;">*</span>{{ form.username }}
        {% if form.username.errors %}
          <div class="error-message">
            {% for error in form.username.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        {{ form.user_type.label_tag }}<span style="color: red;">*</span>{{ form.user_type }}
        {% if form.user_type.errors %}
          <div class="error-message">
            {% for error in form.user_type.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3" id="ministry" style="display: none;">
      <div class="col-md-6">
        {{ form.ministry_name.label_tag }}<span style="color: red;">*</span>{{ form.ministry_name }}
        {% if form.ministry_name.errors %}
          <div class="error-message">
            {% for error in form.ministry_name.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        {{ form.department.label_tag }}<span style="color: red;">*</span>{{ form.department }}
        {% if form.department.errors %}
          <div class="error-message">
            {% for error in form.department.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3" id="state" style="display: none;">
      <div class="col-md-6">
        {{ form.state.label_tag }}<span style="color: red;">*</span>{{ form.state }}
        {% if form.state.errors %}
          <div class="error-message">
            {% for error in form.state.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        {{ form.district.label_tag }}<span style="color: red;">*</span>{{ form.district }}
        {% if form.district.errors %}
          <div class="error-message">
            {% for error in form.district.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3">
      <div class="col">
        {{ form.event_name.label_tag }}<span style="color: red;">*</span>{{ form.event_name }}
        {% if form.event_name.errors %}
          <div class="error-message">
            {% for error in form.event_name.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
     
    </div>

    <div class="row mb-3">
       <div class="col-md-6">
        {{ form.event_state.label_tag }}<span style="color: red;">*</span>{{ form.event_state }}
        {% if form.event_state.errors %}
          <div class="error-message">
            {% for error in form.event_state.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        {{ form.event_district.label_tag }}<span style="color: red;">*</span>{{ form.event_district }}
        {% if form.event_district.errors %}
          <div class="error-message">
            {% for error in form.event_district.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    
    </div>

        <div class="row mb-3">

      <div class="col">
        {{ form.event_venue.label_tag }}<span style="color: red;">*</span>{{ form.event_venue }}
        {% if form.event_venue.errors %}
          <div class="error-message">
            {% for error in form.event_venue.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-md-3">
        {{ form.event_start_date.label_tag }}<span style="color: red;">*</span>{{ form.event_start_date }}
        {% if form.event_start_date.errors %}
          <div class="error-message">
            {% for error in form.event_start_date.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-3">
        {{ form.event_end_date.label_tag }}<span style="color: red;">*</span>{{ form.event_end_date }}
        {% if form.event_end_date.errors %}
          <div class="error-message">
            {% for error in form.event_end_date.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-3">
        {{ form.event_time.label_tag }}<span style="color: red;">*</span>{{ form.event_time }}
        {% if form.event_time.errors %}
          <div class="error-message">
            {% for error in form.event_time.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
       <div class="col-md-3">
        {{ form.no_of_participants.label_tag }}<span style="color: red;">*</span>{{ form.no_of_participants }}
        {% if form.no_of_participants.errors %}
          <div class="error-message">
            {% for error in form.no_of_participants.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3">
     
      <div class="col">
        {{ form.event_description.label_tag }}<span style="color: red;">*</span>{{ form.event_description }}
        {% if form.event_description.errors %}
          <div class="error-message">
            {% for error in form.event_description.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <h4 class="section-title">Upload Media & Documents</h4>
    <div class="row mb-3">
      <div class="col-md-6">
        <label>Event Pictures (Up to 5 images)<span style="color: red;">*</span></label>
        {{ image_form.image }}
        {% if image_form.image.errors %}
          <div class="error-message">
            {% for error in image_form.image.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
      <div class="col-md-6">
        <label>Event Videos (Up to 5 videos)<span style="color: red;">*</span></label>
        {{ video_form.video }}
        {% if video_form.video.errors %}
          <div class="error-message">
            {% for error in video_form.video.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

    <div class="row mb-3">
      <div class="col-12">
        {{ form.youtube_links.label_tag }}<span style="color: red;">*</span>{{ form.youtube_links }}
        {% if form.youtube_links.errors %}
          <div class="error-message">
            {% for error in form.youtube_links.errors %}{{ error }}{% endfor %}
          </div>
        {% endif %}
      </div>
    </div>

        <div class="form-check mb-3">
      <input type="checkbox" class="form-check-input" id="terms" name="terms" value="accepted" required>
      <label class="form-check-label" for="terms" aria-required="true">
        By continuing, you agree to <a href="#">Terms and Conditions</a> and <a href="#">Privacy Policy</a> of Vande Mataram <span style="color: red;">*</span>
      </label>
      {% if form.terms.errors %}
        <div class="error-message">
          {% for error in form.terms.errors %}{{ error }}{% endfor %}
        </div>
      {% endif %}
    </div>

    <div class="d-flex justify-content-end">
      <button type="reset" class="btn btn-outline-secondary me-2">Cancel</button>
      <button type="submit" class="btn btn-warning text-white">Upload Event</button>
    </div>
  </form>
</div>

<script>
  document.getElementById("id_event_state").addEventListener("change", function() {
      let stateId = this.value;
      let districtSelect = document.getElementById("id_event_district");
      districtSelect.innerHTML = "";
      fetch(`/api/districts?state_id=${stateId}`)
        .then(res => res.json())
        .then(data => {
          data.districtList.forEach(d => {
            let opt = document.createElement("option");
            opt.value = d.id;
            opt.textContent = d.name;
            districtSelect.appendChild(opt);
          });
        });
    });
  
  document.getElementById("id_user_type").addEventListener("change", function() {
    let type = this.value;
    let ministry = document.getElementById("ministry");
    let state = document.getElementById("state");

    if (type === "Ministry") {
      // Ministry dropdown
      ministry.style.display = "flex";
      state.style.display = "none";

      // Department text input
      let deptInput = document.getElementById("id_department");
      deptInput.value = "";
      deptInput.placeholder = "Enter Department";

    } else if (type === "State") {
      // State dropdown
      ministry.style.display = "none";
      state.style.display = "flex";

      let stateSelect = document.getElementById("id_state");
      // District dropdown (loads after state selection)
      let districtSelect = document.getElementById("id_district");
      districtSelect.innerHTML = "";

      stateSelect.addEventListener("change", function() {
        let stateId = this.value;
        districtSelect.innerHTML = "";
        fetch(`/api/districts?state_id=${stateId}`)
          .then(res => res.json())
          .then(data => {
            data.districtList.forEach(d => {
              let opt = document.createElement("option");
              opt.value = d.id;
              opt.textContent = d.name;
              districtSelect.appendChild(opt);
            });
          });
      });
    }
  });
</script>
</body>
</html>
